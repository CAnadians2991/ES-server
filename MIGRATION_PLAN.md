# План міграції та інтеграції Google таблиці в CRM

## Аналіз поточної ситуації

### ✅ Що вже працює в CRM:
- Всі основні поля з Google таблиці присутні
- Система ролей та доступів налаштована
- Soft delete та audit log реалізовані
- Базові модулі працюють

### ❌ Що потрібно додати/покращити:

#### 1. Додаткові поля в Candidate:
- `applicationNumber` - номер заявки (якщо потрібен окремо від ID)
- `email` - email кандидата
- `passportNumber` - номер паспорта
- `passportExpiry` - термін дії паспорта
- `education` - освіта
- `workExperience` - досвід роботи
- `languageSkills` - знання мов
- `familyStatus` - сімейний стан
- `children` - кількість дітей

#### 2. Нові моделі:
- `Partner` - партнери компанії
- `Project` - проекти
- `BranchStats` - статистика по філіях

#### 3. Покращення існуючих моделей:
- Додати email та телефон в User
- Розширити Payment модель
- Покращити Vacancy модель

## План реалізації

### Етап 1: Підготовка (1-2 дні)
1. **Бекап поточної бази даних**
2. **Створення міграційних скриптів**
3. **Тестування на копії даних**

### Етап 2: Оновлення схеми (1 день)
1. **Додати нові поля в Candidate**
2. **Створити нові моделі (Partner, Project, BranchStats)**
3. **Оновити існуючі моделі**
4. **Запустити міграцію**

### Етап 3: Оновлення API (2-3 дні)
1. **Оновити API endpoints для Candidate**
2. **Створити API для нових моделей**
3. **Додати валідацію для нових полів**
4. **Оновити audit log**

### Етап 4: Оновлення UI (3-4 дні)
1. **Оновити форму додавання/редагування кандидата**
2. **Додати нові поля в таблицю**
3. **Створити сторінки для нових модулів**
4. **Оновити фільтри та пошук**

### Етап 5: Імпорт даних з Google таблиці (1-2 дні)
1. **Створити скрипт для експорту з Google Sheets**
2. **Створити скрипт для імпорту в CRM**
3. **Валідація та очищення даних**
4. **Тестування імпорту**

### Етап 6: Тестування та налаштування (1-2 дні)
1. **Тестування всіх функцій**
2. **Налаштування прав доступу**
3. **Оптимізація продуктивності**
4. **Документація**

## Система доступів (оновлена)

### Ролі та їх права:

#### ADMIN (Системний адміністратор)
- Повний доступ до всіх модулів
- Управління користувачами
- Перегляд audit log
- Відновлення видалених записів
- Імпорт/експорт даних

#### DIRECTOR (Директор)
- Перегляд всіх модулів
- Статистика та звіти
- Фінансові дані
- Управління філіями

#### RECRUITMENT_DIRECTOR (Директор з рекрутингу)
- Кандидати (повний доступ)
- Вакансії (повний доступ)
- Заявки (повний доступ)
- Статистика по рекрутингу

#### BRANCH_MANAGER (Керівник філії)
- Кандидати своєї філії
- Вакансії
- Заявки своєї філії
- Статистика своєї філії
- Витрати своєї філії

#### ACCOUNTANT (Бухгалтер)
- Платежі (повний доступ)
- Зарплати (повний доступ)
- Витрати (повний доступ)
- Фінансова статистика

#### MANAGER (Менеджер)
- Кандидати (тільки свої)
- Заявки (тільки свої)
- Продажі віз (тільки свої)

#### ADMINISTRATOR (Адміністратор)
- Кандидати (тільки свої)
- Заявки (тільки свої)
- Базова статистика

## Міграційний скрипт

```typescript
// Скрипт для імпорту з Google Sheets
async function importFromGoogleSheets() {
  // 1. Підключення до Google Sheets API
  // 2. Читання даних з таблиці
  // 3. Валідація та очищення даних
  // 4. Імпорт в базу даних
  // 5. Створення audit log записів
}

// Скрипт для експорту в Google Sheets
async function exportToGoogleSheets() {
  // 1. Отримання даних з бази
  // 2. Форматування для Google Sheets
  // 3. Запис в таблицю
  // 4. Логування операції
}
```

## Ризики та мітигація

### Ризики:
1. **Втрата даних** - мітигація: повний бекап перед міграцією
2. **Простої системи** - мітигація: міграція в неробочий час
3. **Помилки валідації** - мітигація: тестування на копії даних
4. **Проблеми з продуктивністю** - мітигація: індексування та оптимізація

### Контрольні точки:
1. Бекап створено ✅
2. Міграція протестована ✅
3. Всі API працюють ✅
4. UI оновлено ✅
5. Дані імпортовані ✅
6. Система протестована ✅

## Наступні кроки

1. **Підтвердження плану** - обговорення з користувачем
2. **Початок реалізації** - поетапне виконання
3. **Тестування** - на кожному етапі
4. **Документація** - оновлення інструкцій
5. **Навчання користувачів** - демонстрація нових функцій
