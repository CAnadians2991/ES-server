# –°–∏—Å—Ç–µ–º–∞ –ó–∞—Ö–∏—Å—Ç—É –î–∞–Ω–∏—Ö (Audit Log + Soft Delete)

## üéØ –©–æ —Ä–µ–∞–ª—ñ–∑–æ–≤–∞–Ω–æ:

### 1. **Audit Log (–Ü—Å—Ç–æ—Ä—ñ—è –ó–º—ñ–Ω)**
–ö–æ–∂–Ω–∞ –∑–º—ñ–Ω–∞ –≤ —Å–∏—Å—Ç–µ–º—ñ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞–ø–∏—Å—É—î—Ç—å—Å—è:
- ‚úÖ –•—Ç–æ –∑–º—ñ–Ω–∏–≤
- ‚úÖ –ö–æ–ª–∏ –∑–º—ñ–Ω–∏–≤  
- ‚úÖ –©–æ –±—É–ª–æ (—Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è)
- ‚úÖ –©–æ —Å—Ç–∞–ª–æ (–Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è)
- ‚úÖ –Ø–∫–µ –ø–æ–ª–µ –∑–º—ñ–Ω–∏–ª–æ—Å—è

### 2. **Soft Delete (–ú'—è–∫–µ –í–∏–¥–∞–ª–µ–Ω–Ω—è)**
- ‚úÖ –í–∏–¥–∞–ª–µ–Ω—ñ –∑–∞–ø–∏—Å–∏ –Ω–µ –≤–∏–¥–∞–ª—è—é—Ç—å—Å—è –∑ –ë–î
- ‚úÖ –ó–∞–ø–∏—Å–∏ –ø–æ–∑–Ω–∞—á–∞—é—Ç—å—Å—è —è–∫ `isDeleted = true`
- ‚úÖ –ú–æ–∂–Ω–∞ –ª–µ–≥–∫–æ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏
- ‚úÖ –ó–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è —Ö—Ç–æ —ñ –∫–æ–ª–∏ –≤–∏–¥–∞–ª–∏–≤

### 3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –õ–æ–≥—É–≤–∞–Ω–Ω—è**
–í—Å—ñ –∑–º—ñ–Ω–∏ –ª–æ–≥—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏:
- CREATE - —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∑–∞–ø–∏—Å—É
- UPDATE - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ—Å–Ω—É—é—á–æ–≥–æ
- DELETE - –≤–∏–¥–∞–ª–µ–Ω–Ω—è (soft delete)
- RESTORE - –≤—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–æ–≥–æ

## üìä –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ë–î:

### AuditLog:
```
- id              - —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π ID
- entityType      - —Ç–∏–ø —Å—É—Ç–Ω–æ—Å—Ç—ñ (Candidate, Payment, —Ç–æ—â–æ)
- entityId        - ID –∑–∞–ø–∏—Å—É
- action          - –¥—ñ—è (CREATE/UPDATE/DELETE/RESTORE)
- userId          - —Ö—Ç–æ –∑—Ä–æ–±–∏–≤ –∑–º—ñ–Ω—É
- userName        - —ñ–º'—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
- fieldName       - —è–∫–µ –ø–æ–ª–µ –∑–º—ñ–Ω–∏–ª–æ—Å—å
- oldValue        - —Å—Ç–∞—Ä–µ –∑–Ω–∞—á–µ–Ω–Ω—è
- newValue        - –Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è
- oldData         - –ø–æ–≤–Ω—ñ —Å—Ç–∞—Ä—ñ –¥–∞–Ω—ñ (JSON)
- newData         - –ø–æ–≤–Ω—ñ –Ω–æ–≤—ñ –¥–∞–Ω—ñ (JSON)
- createdAt       - –∫–æ–ª–∏ –∑—Ä–æ–±–ª–µ–Ω–æ
```

### Candidate (–¥–æ–¥–∞–Ω—ñ –ø–æ–ª—è):
```
- isDeleted       - —á–∏ –≤–∏–¥–∞–ª–µ–Ω–∏–π –∑–∞–ø–∏—Å
- deletedAt       - –∫–æ–ª–∏ –≤–∏–¥–∞–ª–µ–Ω–æ
- deletedBy       - —Ö—Ç–æ –≤–∏–¥–∞–ª–∏–≤
```

## üîß API Endpoints:

### –ü–µ—Ä–µ–≥–ª—è–¥ —ñ—Å—Ç–æ—Ä—ñ—ó –∑–º—ñ–Ω:
```
GET /api/audit-logs?entityType=Candidate&entityId=123&limit=50
```

### –í—ñ–¥–∫–∞—Ç –∑–º—ñ–Ω–∏:
```
POST /api/audit-logs/revert/[auditLogId]
```

## üí° –Ø–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏:

### 1. –ü–µ—Ä–µ–≥–ª—è–¥ —ñ—Å—Ç–æ—Ä—ñ—ó –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:
```typescript
const history = await fetch('/api/audit-logs?entityType=Candidate&entityId=123')
const logs = await history.json()
```

### 2. –í—ñ–¥–∫–∞—Ç –ø–æ–º–∏–ª–∫–æ–≤–æ—ó –∑–º—ñ–Ω–∏:
```typescript
await fetch('/api/audit-logs/revert/456', { method: 'POST' })
```

### 3. –í—ñ–¥–Ω–æ–≤–ª–µ–Ω–Ω—è –≤–∏–¥–∞–ª–µ–Ω–æ–≥–æ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:
```typescript
// –ó–Ω–∞–π—Ç–∏ audit log –∑ action=DELETE
// –í–∏–∫–ª–∏–∫–∞—Ç–∏ revert –¥–ª—è —Ü—å–æ–≥–æ –ª–æ–≥—É
await fetch('/api/audit-logs/revert/789', { method: 'POST' })
```

## üé® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è UI:

### –î–æ–¥–∞—Ç–∏ –∫–Ω–æ–ø–∫—É "–Ü—Å—Ç–æ—Ä—ñ—è –∑–º—ñ–Ω" –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ –∫–∞–Ω–¥–∏–¥–∞—Ç–∞:
- –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ —Å–ø–∏—Å–æ–∫ –≤—Å—ñ—Ö –∑–º—ñ–Ω
- –§–æ—Ä–º–∞—Ç: "01.10.2025 14:30 - –Ü–≤–∞–Ω –ü–µ—Ç—Ä–µ–Ω–∫–æ –∑–º—ñ–Ω–∏–≤ –¢–µ–ª–µ—Ñ–æ–Ω –∑ +380501234567 –Ω–∞ +380509876543"
- –ö–Ω–æ–ø–∫–∞ "–í—ñ–¥–∫–æ—Ç–∏—Ç–∏" –±—ñ–ª—è –∫–æ–∂–Ω–æ—ó –∑–º—ñ–Ω–∏

### –î–æ–¥–∞—Ç–∏ —Ä–æ–∑–¥—ñ–ª "–í–∏–¥–∞–ª–µ–Ω—ñ –∑–∞–ø–∏—Å–∏":
- –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –≤—Å—ñ –≤–∏–¥–∞–ª–µ–Ω—ñ –∫–∞–Ω–¥–∏–¥–∞—Ç–∏
- –ö–Ω–æ–ø–∫–∞ "–í—ñ–¥–Ω–æ–≤–∏—Ç–∏"
- –§—ñ–ª—å—Ç—Ä –ø–æ –¥–∞—Ç—ñ –≤–∏–¥–∞–ª–µ–Ω–Ω—è

### –ü–æ–∫–∞–∑—É–≤–∞—Ç–∏ –ø–æ–ø–µ—Ä–µ–¥–∂–µ–Ω–Ω—è –ø–µ—Ä–µ–¥ –≤–∏–¥–∞–ª–µ–Ω–Ω—è–º:
- "–¶–µ–π –∑–∞–ø–∏—Å –±—É–¥–µ –ø–æ–∑–Ω–∞—á–µ–Ω–∏–π —è–∫ –≤–∏–¥–∞–ª–µ–Ω–∏–π"
- "–í–∏ –∑–º–æ–∂–µ—Ç–µ –≤—ñ–¥–Ω–æ–≤–∏—Ç–∏ –π–æ–≥–æ –≤ –±—É–¥—å-—è–∫–∏–π —á–∞—Å"

## üîê –ü–µ—Ä–µ–≤–∞–≥–∏:

‚úÖ **–ë–µ–∑–ø–µ–∫–∞**: –ù—ñ—â–æ –Ω–µ –≤–∏–¥–∞–ª—è—î—Ç—å—Å—è –Ω–∞–∑–∞–≤–∂–¥–∏
‚úÖ **–í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è**: –ü–æ–≤–Ω–∞ —ñ—Å—Ç–æ—Ä—ñ—è –≤—Å—ñ—Ö –∑–º—ñ–Ω
‚úÖ **–í—ñ–¥–∫–∞—Ç**: –õ–µ–≥–∫–æ –≤–∏–ø—Ä–∞–≤–∏—Ç–∏ –ø–æ–º–∏–ª–∫–∏
‚úÖ **–ê—É–¥–∏—Ç**: –•—Ç–æ, –∫–æ–ª–∏, —â–æ –∑–º—ñ–Ω–∏–≤
‚úÖ **–®–≤–∏–¥–∫—ñ—Å—Ç—å**: –ù–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É—î —Å–∏—Å—Ç–µ–º—É

## üìù –ù–∞—Å—Ç—É–ø–Ω—ñ –∫—Ä–æ–∫–∏:

1. ‚úÖ –°—Ö–µ–º–∞ –ë–î –≥–æ—Ç–æ–≤–∞
2. ‚úÖ API –≥–æ—Ç–æ–≤–µ
3. ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –ª–æ–≥—É–≤–∞–Ω–Ω—è –ø—Ä–∞—Ü—é—î
4. ‚è≥ –¢—Ä–µ–±–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ UI –¥–ª—è –ø–µ—Ä–µ–≥–ª—è–¥—É —ñ—Å—Ç–æ—Ä—ñ—ó
5. ‚è≥ –¢—Ä–µ–±–∞ —Å—Ç–≤–æ—Ä–∏—Ç–∏ UI –¥–ª—è –≤—ñ–¥–∫–∞—Ç—É –∑–º—ñ–Ω
6. ‚è≥ –î–æ–¥–∞—Ç–∏ —Ä–æ–ª—å –¥–æ—Å—Ç—É–ø—É (—Ç—ñ–ª—å–∫–∏ ADMIN –º–æ–∂–µ –≤—ñ–¥–∫–æ—á—É–≤–∞—Ç–∏)

## üéØ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –∑–∞–º—ñ—Å—Ç—å –±–µ–∫–∞–ø—ñ–≤ –∫–æ–∂–Ω—ñ 2 —Ö–≤:

Audit Log –ö–†–ê–©–ï –Ω—ñ–∂ —á–∞—Å—Ç—ñ—à–µ –±–µ–∫–∞–ø–∏:
- ‚úÖ –ü—Ä–∞—Ü—é—î –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- ‚úÖ –¢–æ—á–Ω—ñ –¥–∞–Ω—ñ (–Ω–µ –≤—Ç—Ä–∞—á–∞—î—Ç—å—Å—è –Ω—ñ—á–æ–≥–æ –º—ñ–∂ –±–µ–∫–∞–ø–∞–º–∏)
- ‚úÖ –ú–æ–∂–Ω–∞ –≤—ñ–¥–∫–æ—Ç–∏—Ç–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É –∑–º—ñ–Ω—É (–Ω–µ –≤–µ—Å—å –±–µ–∫–∞–ø)
- ‚úÖ –ù–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É—î –¥–∏—Å–∫
- ‚úÖ –®–≤–∏–¥—à–µ –ø—Ä–∞—Ü—é—î

**–î–ª—è –ø–æ–≤–Ω–æ–≥–æ –∑–∞—Ö–∏—Å—Ç—É —Ä–µ–∫–æ–º–µ–Ω–¥—É—é:**
1. ‚úÖ Audit Log (–≤–∂–µ –∑—Ä–æ–±–ª–µ–Ω–æ) - –¥–ª—è –≤—ñ–¥–∫–∞—Ç—É –ø–æ–º–∏–ª–æ–∫
2. üì¶ –©–æ–¥–µ–Ω–Ω—ñ –±–µ–∫–∞–ø–∏ PostgreSQL - –¥–ª—è –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ—ñ—á–Ω–∏—Ö –≤–∏–ø–∞–¥–∫—ñ–≤
3. üîí –†–µ–≥—É–ª—è—Ä–Ω—ñ –±–µ–∫–∞–ø–∏ –Ω–∞ –æ–∫—Ä–µ–º–∏–π —Å–µ—Ä–≤–µ—Ä

## üöÄ –Ø–∫ –Ω–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ —â–æ–¥–µ–Ω–Ω—ñ –±–µ–∫–∞–ø–∏ (PostgreSQL):

```bash
# –î–æ–¥–∞–π –≤ crontab:
0 2 * * * pg_dump -U postgres europe_service_crm > /backups/db_$(date +\%Y\%m\%d).sql
```

–¶–µ —Å—Ç–≤–æ—Ä–∏—Ç—å –±–µ–∫–∞–ø –∫–æ–∂–Ω–æ–≥–æ –¥–Ω—è –æ 2:00 –Ω–æ—á—ñ.

